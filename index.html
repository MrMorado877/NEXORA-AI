<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Assistant ChatGPT Style + Code Boxes</title>
<style>
body {margin:0;font-family:Arial;background:#0a0a0a;color:white;overflow-x:hidden;}
header{background:#111;padding:15px;text-align:center;font-size:22px;position:relative;}
#hamburger{position:absolute;left:15px;top:15px;font-size:28px;cursor:pointer;}
#chatBox{height:60vh;overflow-y:auto;padding:15px;background:#111;margin-left:0;transition:margin-left 0.3s;}
.message{padding:10px 14px;margin:10px 0;max-width:75%;border-radius:12px;white-space:pre-wrap;word-wrap:break-word;}
.user{background:#222;margin-left:auto;}   /* subtle gray */
.ai{background:#333;margin-right:auto;}    /* slightly lighter gray */

/* Code block style */
.codeBlock{background:#000;color:#0f0;padding:10px;border-radius:8px;font-family:monospace;position:relative;}
.codeButtons{position:absolute;top:5px;right:5px;}
.codeButtons button{margin-left:5px;padding:3px 6px;font-size:12px;border:none;border-radius:4px;cursor:pointer;}

/* Bottom input */
.bottom{display:flex;padding:10px;background:#1b1b1b;position:fixed;bottom:0;width:100%;}
#userInput{flex:1;padding:15px;border-radius:25px;border:none;background:#222;color:white;}
#sendBtn{width:50px;height:50px;margin-left:10px;border-radius:50%;border:none;background:cyan;font-size:22px;cursor:pointer;}

/* Floating mic */
#assistantBtn{position:fixed;bottom:80px;right:20px;width:60px;height:60px;border-radius:50%;background:cyan;color:black;font-size:28px;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 0 15px cyan;}
@keyframes glow{0%{box-shadow:0 0 5px #0ff}50%{box-shadow:0 0 25px #0ff}100%{box-shadow:0 0 5px #0ff}}
#assistantBtn:hover{animation:glow 1.5s infinite;}

/* Sidebar */
#sidebar{
  height:100%;width:0;position:fixed;top:0;left:0;background:#222;overflow-x:hidden;transition:0.3s;padding-top:60px;
  box-shadow:2px 0 10px #000;
}
#sidebar h2{color:#0ff;text-align:center;margin-bottom:20px;}
#sidebar ul{list-style:none;padding:0 15px;}
#sidebar li{margin-bottom:10px;padding:8px;background:#111;border-radius:6px;cursor:pointer;}
#sidebar li:hover{background:#333;}
</style>
</head>
<body>

<header>
  <span id="hamburger">&#9776;</span>
  âœ¨ AI Assistant
</header>

<div id="sidebar">
  <h2>Chat History</h2>
  <ul id="historyList"></ul>
</div>

<div id="chatBox"></div>

<div class="bottom">
  <input id="userInput" placeholder="Message AI...">
  <button id="sendBtn">â¬†</button>
</div>

<div id="assistantBtn" title="Voice Input">ðŸŽ¤</div>

<script>
const BACKEND = "http://localhost:5000";
let chatHistory = [];

// Sidebar toggle
document.getElementById("hamburger").onclick = () => {
  const sidebar = document.getElementById("sidebar");
  const chatBox = document.getElementById("chatBox");
  if(sidebar.style.width === "250px"){
    sidebar.style.width = "0";
    chatBox.style.marginLeft = "0";
  } else {
    sidebar.style.width = "250px";
    chatBox.style.marginLeft = "250px";
  }
};

// Add emojis and exclamation marks
function addEmojis(text){
  const emojis = ["ðŸ˜„","âœ¨","ðŸŽ‰","ðŸ˜Ž","ðŸ‘","ðŸ”¥","ðŸ¤”","ðŸ˜†","ðŸ™Œ","ðŸ’¡"];
  return text.split(" ").map(word=>{
    if(Math.random() < 0.2) return word + " " + emojis[Math.floor(Math.random()*emojis.length)];
    return word;
  }).join(" ") + "!";
}

// Append single follow-up
function appendFollowUp(reply){
  return reply + "\n\nDo you want information about something related?";
}

// Add message to chat box
function addMessage(text,type){
  const box=document.getElementById("chatBox");
  const div=document.createElement("div");
  div.className=`message ${type}`;

  // Detect if message contains code (```...```)
  if(text.includes("```")){
    const codeContent = text.replace(/```/g,""); // remove ```
    const codeDiv = document.createElement("div");
    codeDiv.className="codeBlock";
    codeDiv.innerText = codeContent;

    // Add copy & edit buttons
    const btnDiv = document.createElement("div");
    btnDiv.className="codeButtons";
    const copyBtn = document.createElement("button");
    copyBtn.innerText="Copy";
    copyBtn.onclick=()=>{navigator.clipboard.writeText(codeContent);}
    const editBtn = document.createElement("button");
    editBtn.innerText="Edit";
    editBtn.onclick=()=>{document.getElementById("userInput").value = codeContent; document.getElementById("userInput").focus();}
    btnDiv.appendChild(copyBtn);
    btnDiv.appendChild(editBtn);
    codeDiv.appendChild(btnDiv);
    div.appendChild(codeDiv);
  } else {
    div.innerText=text;
  }

  box.appendChild(div);
  box.scrollTop=box.scrollHeight;

  // Update sidebar history
  const historyList=document.getElementById("historyList");
  const li=document.createElement("li");
  li.innerText=(type==="user"?"You: ":"AI: ") + text.replace(/```/g,"");
  li.onclick=()=>{document.getElementById("userInput").value=text.replace(/```/g,""); sendChat();}
  historyList.appendChild(li);
}

// Send chat to backend
async function sendChat(){
  const input=document.getElementById("userInput");
  const msg=input.value.trim();
  if(!msg) return;
  addMessage(msg,"user");
  chatHistory.push({type:"user",text:msg});
  input.value="";

  try{
    const res=await fetch(BACKEND+"/api/chat",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({message:msg})
    });
    const data=await res.json();
    let reply = addEmojis(data.reply);
    reply = appendFollowUp(reply);
    addMessage(reply,"ai");
    chatHistory.push({type:"ai",text:reply});
    speak(reply);
  }catch(e){console.error(e);}
}

// Voice input
document.getElementById("assistantBtn").onclick=()=>{
  const recognition=new (window.SpeechRecognition||window.webkitSpeechRecognition)();
  recognition.lang="en-US";
  recognition.start();
  recognition.onresult=e=>{
    const msg=e.results[0][0].transcript;
    document.getElementById("userInput").value=msg;
    sendChat();
  };
};

// Voice output
function speak(text){
  const utter=new SpeechSynthesisUtterance(text);
  utter.lang="en-US";
  speechSynthesis.speak(utter);
}

// Send button & Enter key
document.getElementById("sendBtn").onclick=sendChat;
document.getElementById("userInput").addEventListener("keypress",e=>{if(e.key==="Enter") sendChat();});
</script>
</body>
</html>
