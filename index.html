<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Nexora AI</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#0f0f0f;
  --sidebar:#111;
  --user:#3b3b3b;
  --bot:#222;
  --accent:#6C63FF;
  --text:#fff;
}
*{box-sizing:border-box;}
body{
  margin:0;
  font-family:Inter,sans-serif;
  background:var(--bg);
  color:var(--text);
  height:100vh;
  display:flex;
}

/* SIDEBAR */
.sidebar{
  width:240px;
  background:var(--sidebar);
  padding:15px;
  display:flex;
  flex-direction:column;
  border-right:1px solid #222;
}
.sidebar img{
  width:60px;height:60px;border-radius:50%;
  margin:auto;border:2px solid var(--accent);
}
.sidebar p{text-align:center;margin:10px 0;font-size:14px;}
.sidebar button{
  margin-top:8px;
  background:var(--accent);
  border:none;
  color:#fff;
  padding:8px;
  border-radius:8px;
  cursor:pointer;
}
.chat-list{
  margin-top:15px;
  flex:1;
  overflow-y:auto;
}
.chat-list button{
  width:100%;
  background:#1b1b1b;
  border:none;
  color:#fff;
  padding:8px;
  margin-bottom:6px;
  border-radius:6px;
  text-align:left;
  cursor:pointer;
}

/* MAIN */
.main{
  flex:1;
  display:flex;
  flex-direction:column;
}
#chatArea{
  flex:1;
  padding:20px;
  overflow-y:auto;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.msg{
  max-width:75%;
  padding:12px 15px;
  border-radius:12px;
  animation:fade 0.3s ease;
}
.user{background:var(--user);align-self:flex-end;}
.bot{background:var(--bot);align-self:flex-start;white-space:pre-line;}

@keyframes fade{
  from{opacity:0;transform:translateY(10px);}
  to{opacity:1;}
}

.input-bar{
  padding:15px;
  border-top:1px solid #222;
}
input{
  width:100%;
  padding:15px;
  border-radius:30px;
  border:none;
  background:#1a1a1a;
  color:white;
  font-size:16px;
}

/* MOBILE */
@media(max-width:700px){
  body{flex-direction:column;}
  .sidebar{width:100%;flex-direction:row;align-items:center;gap:10px;}
  .chat-list{display:flex;overflow-x:auto;}
  .chat-list button{min-width:150px;}
}
</style>
</head>

<body>

<div class="sidebar">
  <img id="pic">
  <p id="email"></p>
  <button onclick="logout()">Logout</button>
  <div class="chat-list" id="chatList"></div>
</div>

<div class="main">
  <div id="chatArea"></div>
  <div class="input-bar">
    <input id="input" placeholder="Ask Nexora..." />
  </div>
</div>

<script>
const backend="https://backend-b80q.onrender.com";

document.getElementById("pic").src=localStorage.getItem("userPic")||"https://via.placeholder.com/60";
document.getElementById("email").innerText=localStorage.getItem("userEmail");

function logout(){
  localStorage.clear();
  window.location.href="login.html";
}

const input=document.getElementById("input");
const chatArea=document.getElementById("chatArea");
const chatList=document.getElementById("chatList");

let currentChat=null;

/* LOAD CHAT TITLES */
async function loadChats(){
  const res=await fetch(backend+"/api/chat/titles",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({email:localStorage.getItem("userEmail")})
  });
  const data=await res.json();
  chatList.innerHTML="";
  if(data.titles){
    data.titles.forEach(c=>{
      const b=document.createElement("button");
      b.innerText=c.title;
      b.onclick=()=>loadChat(c.id);
      chatList.appendChild(b);
    });
    if(data.titles.length>0) loadChat(data.titles[0].id);
  }
}

/* LOAD CHAT HISTORY */
async function loadChat(id){
  currentChat=id;
  const res=await fetch(backend+"/api/chat/history",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({chatId:id})
  });
  const data=await res.json();
  chatArea.innerHTML="";
  data.history.forEach(m=>{
    const div=document.createElement("div");
    div.className="msg "+(m.sender==="user"?"user":"bot");
    div.innerText=m.content;
    chatArea.appendChild(div);
  });
  chatArea.scrollTop=chatArea.scrollHeight;
}

/* SEND MESSAGE */
input.addEventListener("keydown",async e=>{
  if(e.key==="Enter"){
    const msg=input.value.trim();
    if(!msg) return;
    input.value="";

    const u=document.createElement("div");
    u.className="msg user";
    u.innerText=msg;
    chatArea.appendChild(u);

    const b=document.createElement("div");
    b.className="msg bot";
    b.innerText="Typing...";
    chatArea.appendChild(b);

    const res=await fetch(backend+"/api/chat",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({
        email:localStorage.getItem("userEmail"),
        message:msg,
        language:"English"
      })
    });

    const data=await res.json();
    b.innerText=data.reply;
    chatArea.scrollTop=chatArea.scrollHeight;
    loadChats();
  }
});

loadChats();
</script>

</body>
</html>
