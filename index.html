<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nexora AI</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0f0f0f; --glass:rgba(0,0,0,0.55); --text:#fff; --accent:#6C63FF;
  --border:rgba(255,255,255,0.2); --input-bg:#1a1a1a; --bot-bg:#252525;
  --user-bg:#3b3b3b; --sidebar-bg:#111;
}
body{margin:0;font-family:'Inter',sans-serif;display:flex;height:100vh;overflow:hidden;background:var(--bg);color:var(--text);}
.sidebar{width:220px;background:var(--sidebar-bg);display:flex;flex-direction:column;align-items:center;padding:20px;border-right:1px solid var(--border);transition:width 0.3s;}
.sidebar.collapsed{width:60px;}
.sidebar img{width:60px;height:60px;border-radius:50%;border:2px solid var(--accent);margin-bottom:10px;transition:opacity 0.3s;}
.sidebar.collapsed img{opacity:0;}
.sidebar p{font-size:14px;text-align:center;margin:0;transition:opacity 0.3s;}
.sidebar.collapsed p{opacity:0;}
.sidebar button{background:var(--accent);border:none;color:#fff;padding:10px;width:100%;margin-top:8px;border-radius:8px;cursor:pointer;transition:0.2s,opacity 0.3s;}
.sidebar.collapsed button{width:50px;padding:10px 0;font-size:0;opacity:0.7;}
.sidebar button:hover{background:#574bff;}
#collapseBtn{margin-top:20px;background:var(--accent);border-radius:50%;width:35px;height:35px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-weight:bold;transition:transform 0.3s;}
#collapseBtn:hover{background:#574bff;}
.sidebar.collapsed #collapseBtn{transform:rotate(180deg);}
.chat-titles{width:100%;margin-top:20px;display:flex;flex-direction:column;gap:8px;overflow-y:auto;max-height:300px;}
.chat-titles button{background:#1a1a1a;border:none;color:#fff;padding:8px;text-align:left;border-radius:6px;cursor:pointer;transition:0.2s;}
.chat-titles button:hover{background:#333;}
.main{flex:1;display:flex;flex-direction:column;position:relative;}
#chatArea{flex:1;padding:20px;overflow-y:auto;display:flex;flex-direction:column;gap:12px;}
.message-box{padding:12px 18px;border-radius:12px;max-width:70%;word-wrap:break-word;animation:fadeIn 0.3s;}
.user-msg{background:var(--user-bg);align-self:flex-end;}
.bot-msg{background:var(--bot-bg);align-self:flex-start;position:relative;}
.search-wrapper{position:sticky;bottom:0;background:var(--bg);padding:15px 20px;display:flex;justify-content:center;border-top:1px solid var(--border);}
.search-bar{width:80%;padding:15px 20px;border-radius:30px;background:var(--input-bg);color:var(--text);border:1px solid var(--border);outline:none;font-size:16px;}
.search-bar:focus{border:1px solid var(--accent);box-shadow:0 0 10px var(--accent);}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
</style>
</head>
<body>
<div class="sidebar" id="sidebar">
  <img id="profilePic" src="" alt="Profile">
  <p id="userEmail">User Email</p>
  <button onclick="logout()">Logout</button>
  <div class="chat-titles" id="chatTitles"></div>
  <div id="collapseBtn" onclick="toggleSidebar()">â®œ</div>
</div>
<div class="main">
  <div id="chatArea"></div>
  <div class="search-wrapper">
    <input id="input" class="search-bar" placeholder="Ask Nexora...">
  </div>
</div>

<script>
const backend = "https://backend-b80q.onrender.com/api/chat";

const input = document.getElementById("input");
const chatArea = document.getElementById("chatArea");
const chatTitles = document.getElementById("chatTitles");
const sidebar = document.getElementById("sidebar");

document.getElementById("profilePic").src = localStorage.getItem("userPic") || "https://via.placeholder.com/60";
document.getElementById("userEmail").innerText = localStorage.getItem("userEmail") || "user@example.com";

function toggleSidebar(){sidebar.classList.toggle("collapsed");}
function logout(){localStorage.clear(); window.location.href="login.html";}

// Load chat titles
async function loadChatTitles(){
  try{
    const res = await fetch(backend + "/titles",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({email:localStorage.getItem("userEmail")})
    });
    const data = await res.json();
    chatTitles.innerHTML="";
    if(data.titles){
      data.titles.forEach(t=>{
        const btn=document.createElement("button");
        btn.innerText=t.title;
        btn.onclick=()=>loadChatHistory(t.id);
        chatTitles.appendChild(btn);
      });
    }
  }catch(e){console.error(e);}
}

// Load chat history
async function loadChatHistory(chatId){
  try{
    const res = await fetch(backend + "/history",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({chatId})
    });
    const data = await res.json();
    chatArea.innerHTML="";
    data.history.forEach(msg=>{
      const div=document.createElement("div");
      div.className="message-box "+(msg.sender==="user"?"user-msg":"bot-msg");
      div.innerText=msg.content;
      chatArea.appendChild(div);
    });
    chatArea.scrollTop = chatArea.scrollHeight;
  }catch(e){console.error(e);}
}

// Send message
input.addEventListener("keypress", async (e)=>{
  if(e.key==="Enter"){
    const msg=input.value.trim();
    if(!msg) return;
    input.value="";
    const userMsg=document.createElement("div");
    userMsg.className="message-box user-msg";
    userMsg.innerText=msg;
    chatArea.appendChild(userMsg);

    const botMsg=document.createElement("div");
    botMsg.className="message-box bot-msg";
    botMsg.innerText="Typing...";
    chatArea.appendChild(botMsg);
    chatArea.scrollTop = chatArea.scrollHeight;

    try{
      const res = await fetch(backend,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({
          message:msg,
          language:localStorage.getItem("lang"),
          email:localStorage.getItem("userEmail")
        })
      });
      const data = await res.json();
      botMsg.innerText=data.reply;
      chatArea.scrollTop = chatArea.scrollHeight;
      loadChatTitles();
    }catch(e){botMsg.innerText="Server error!";console.error(e);}
  }
});

// Initial load
loadChatTitles();
</script>
</body>
</html>
